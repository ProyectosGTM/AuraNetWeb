<div class="container-fluid" [@fadeInRight]>
  <div class="row">
    <div class="col-12">
      <div class="title-banner-card shadow-sm">
        <div class="title-banner-content d-flex align-items-center justify-content-between flex-wrap p-1 pb-0">
          <div class="d-flex align-items-center gap-3">
            <div class="title-icon">
              <i class="fas fa-plus"></i>
            </div>
            <div>
              <h4 class="title-title">{{ title }}</h4>
              <p class="title-subtitle">Captura la información requerida para el registro.</p>
            </div>
          </div>
          <div class="title-actions">
            <div class="title-tagline">
              <span class="line"></span>
              <span class="text">Control y configuración centralizada</span>
            </div>
          </div>
        </div>
        <div class="row mt-3 gy-4">
          <form [formGroup]="afiliadoForm">
            <div class="col-12">
              <div class="row mt-0">
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Sala *</span>
                      <div class="input-sleek select-sleek" [class.is-open]="isSalaOpen"
                        (mousedown)="toggleSala($event)">
                        <i class="fas fa-building"></i>
                        <div class="sleek-control select-display">
                          <span class="select-value" [class.placeholder]="!afiliadoForm.get('idSala')?.value">
                            {{ salaLabel || 'Selecciona una sala...' }}
                          </span>
                        </div>
                        <span class="sleek-line"></span>
                        <div class="select-panel" *ngIf="isSalaOpen" (mousedown)="$event.stopPropagation()">
                          <button type="button" class="select-option" *ngFor="let s of listaSalas"
                            (mousedown)="setSala(s.id, s.nombreSala || s.nombre, $event)">
                            {{ s.nombreSala || s.nombre }}
                          </button>
                          <div *ngIf="listaSalas.length === 0" class="select-option select-option-disabled">
                            No hay salas disponibles
                          </div>
                        </div>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Tipo Identificación *</span>
                      <div class="input-sleek select-sleek" [class.is-open]="isTipoIdentificacionOpen"
                        (mousedown)="toggleTipoIdentificacion($event)">
                        <i class="fas fa-id-card"></i>
                        <div class="sleek-control select-display">
                          <span class="select-value" [class.placeholder]="!afiliadoForm.get('idTipoIdentificacion')?.value">
                            {{ tipoIdentificacionLabel || 'Selecciona un tipo...' }}
                          </span>
                        </div>
                        <span class="sleek-line"></span>
                        <div class="select-panel" *ngIf="isTipoIdentificacionOpen" (mousedown)="$event.stopPropagation()">
                          <button type="button" class="select-option" *ngFor="let t of listaTipoIdentificacion"
                            (mousedown)="setTipoIdentificacion(t.id, t.text, $event)">
                            {{ t.text }}
                          </button>
                          <div *ngIf="listaTipoIdentificacion.length === 0" class="select-option select-option-disabled">
                            No hay tipos disponibles
                          </div>
                        </div>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Número Identificación *</span>
                      <div class="input-sleek">
                        <i class="fas fa-hashtag"></i>
                        <input formControlName="numeroIdentificacion" class="sleek-control" type="text"
                          placeholder="ABC123456" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Nombre *</span>
                      <div class="input-sleek">
                        <i class="fas fa-user"></i>
                        <input formControlName="nombre" class="sleek-control" type="text"
                          placeholder="Juan" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Apellido Paterno *</span>
                      <div class="input-sleek">
                        <i class="fas fa-user"></i>
                        <input formControlName="apellidoPaterno" class="sleek-control" type="text"
                          placeholder="Pérez" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Apellido Materno</span>
                      <div class="input-sleek">
                        <i class="fas fa-user"></i>
                        <input formControlName="apellidoMaterno" class="sleek-control" type="text"
                          placeholder="García" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Fecha Nacimiento *</span>
                      <div class="input-sleek">
                        <i class="fas fa-calendar-alt"></i>
                        <input formControlName="fechaNacimiento" class="sleek-control" type="date" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Sexo *</span>
                      <div class="input-sleek select-sleek" [class.is-open]="isSexoOpen"
                        (mousedown)="toggleSexo($event)">
                        <i class="fas fa-venus-mars"></i>
                        <div class="sleek-control select-display">
                          <span class="select-value" [class.placeholder]="!afiliadoForm.get('sexo')?.value">
                            {{ afiliadoForm.get('sexo')?.value === 'M' ? 'Masculino' : afiliadoForm.get('sexo')?.value === 'F' ? 'Femenino' : 'Selecciona...' }}
                          </span>
                        </div>
                        <span class="sleek-line"></span>
                        <div class="select-panel" *ngIf="isSexoOpen" (mousedown)="$event.stopPropagation()">
                          <button type="button" class="select-option" (mousedown)="setSexo('M', $event)">
                            Masculino
                          </button>
                          <button type="button" class="select-option" (mousedown)="setSexo('F', $event)">
                            Femenino
                          </button>
                        </div>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Estatus Afiliado *</span>
                      <div class="input-sleek select-sleek" [class.is-open]="isEstatusAfiliadoOpen"
                        (mousedown)="toggleEstatusAfiliado($event)">
                        <i class="fas fa-toggle-on"></i>
                        <div class="sleek-control select-display">
                          <span class="select-value" [class.placeholder]="!afiliadoForm.get('idEstatusAfiliado')?.value">
                            {{ estatusAfiliadoLabel || 'Selecciona un estatus...' }}
                          </span>
                        </div>
                        <span class="sleek-line"></span>
                        <div class="select-panel" *ngIf="isEstatusAfiliadoOpen" (mousedown)="$event.stopPropagation()">
                          <button type="button" class="select-option" *ngFor="let e of listaEstatusAfiliado"
                            (mousedown)="setEstatusAfiliado(e.id, e.text, $event)">
                            {{ e.text }}
                          </button>
                          <div *ngIf="listaEstatusAfiliado.length === 0" class="select-option select-option-disabled">
                            No hay estatus disponibles
                          </div>
                        </div>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Email *</span>
                      <div class="input-sleek">
                        <i class="fas fa-envelope"></i>
                        <input formControlName="email" class="sleek-control" type="email"
                          placeholder="juan.perez@example.com" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 mt-1">
                    <label class="field">
                      <span class="field-label text-white">Teléfono Celular *</span>
                      <div class="input-sleek">
                        <i class="fas fa-phone"></i>
                        <input formControlName="telefonoCelular" class="sleek-control" maxlength="10"
                        (keypress)="allowOnlyNumbers($event)"
                          placeholder="5551234567" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                </div>

              <!-- Botones de acción -->
              <div class="row mt-4">
                <div class="col-12 d-flex justify-content-start gap-3 flex-wrap">
                  <button (click)="guardar()" type="button" class="btn-alt btn-alt--success" [disabled]="loading || afiliadoForm.invalid">
                    <i class="fas fa-check"></i>
                    <span>{{ submitButton }}</span>
                  </button>
                  <button (click)="cancelar()" type="button" class="btn-alt btn-alt--cancel" [disabled]="loading">
                    <i class="fas fa-times"></i>
                    <span>Cancelar</span>
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
