<div class="container-fluid recarga-page" [@fadeInRight]>
  <div class="row">
    <div class="col-12">
      <div class="title-banner-card shadow-sm">
        <div class="title-banner-content d-flex align-items-center justify-content-between flex-wrap p-1 pb-0">
          <div class="d-flex align-items-center gap-3">
            <div class="title-icon">
              <i class="fas fa-wallet"></i>
            </div>
            <div>
              <h4 class="title-title">Módulo de Recarga</h4>
              <p class="title-subtitle">
                Realiza operaciones de carga de efectivo a monederos
              </p>
            </div>
          </div>
          <div class="title-actions">
            <div class="title-tagline">
              <span class="line"></span>
              <span class="text">Carga rápida y segura</span>
            </div>
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-12">
            <div class="recarga-main-card">
              <form [formGroup]="recargaForm">
                <div class="row g-3">
                  <!-- Información del Turno -->
                  <div class="col-12 col-lg-6">
                    <div class="info-card info-card-turno">
                      <div class="info-card-header">
                        <div class="info-card-icon icon-turno">
                          <i class="fas fa-cash-register"></i>
                        </div>
                        <div>
                          <h5 class="info-card-title">Turno de Caja</h5>
                          <p class="info-card-subtitle">Selecciona el turno activo</p>
                        </div>
                      </div>
                      <div class="info-card-body">
                        <label class="field">
                          <span class="field-label text-white">Turno *</span>
                          <div class="input-sleek select-sleek" [class.is-open]="isTurnoCajaOpen"
                            (mousedown)="toggleTurnoCaja($event)">
                            <i class="fas fa-cash-register"></i>
                            <div class="sleek-control select-display">
                              <span class="select-value" [class.placeholder]="!recargaForm.get('idTurnoCaja')?.value">
                                {{ turnoCajaLabel || 'Selecciona un turno...' }}
                              </span>
                            </div>
                            <span class="sleek-line"></span>
                            <div class="select-panel" *ngIf="isTurnoCajaOpen" (mousedown)="$event.stopPropagation()">
                              <button type="button" class="select-option" *ngFor="let t of listaTurnos"
                                (mousedown)="setTurnoCaja(t.id, t.text, $event)">
                                {{ t.text }}
                              </button>
                              <div *ngIf="listaTurnos.length === 0" class="select-option select-option-disabled">
                                No hay turnos disponibles
                              </div>
                            </div>
                          </div>
                        </label>
                        <div class="info-display" *ngIf="turnoSeleccionado">
                          <div class="info-row">
                            <span class="info-label">
                              <i class="fas fa-building"></i>
                              Sala:
                            </span>
                            <span class="info-value">{{ turnoSeleccionado.nombreSala || 'Sin registro' }}</span>
                          </div>
                          <div class="info-row">
                            <span class="info-label">
                              <i class="fas fa-calendar-alt"></i>
                              Fecha Apertura:
                            </span>
                            <span class="info-value">{{ formatearFechaHora(turnoSeleccionado.fechaApertura) }}</span>
                          </div>
                          <div class="info-row">
                            <span class="info-label">
                              <i class="fas fa-dollar-sign"></i>
                              Fondo Inicial:
                            </span>
                            <span class="info-value">{{ formatearMoneda(turnoSeleccionado.fondoInicial) }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Información del Monedero -->
                  <div class="col-12 col-lg-6">
                    <div class="info-card info-card-monedero">
                      <div class="info-card-header">
                        <div class="info-card-icon icon-monedero">
                          <i class="fas fa-wallet"></i>
                        </div>
                        <div>
                          <h5 class="info-card-title">Monedero</h5>
                          <p class="info-card-subtitle">Selecciona el monedero a recargar</p>
                        </div>
                      </div>
                      <div class="info-card-body">
                        <label class="field">
                          <span class="field-label text-white">Monedero *</span>
                          <div class="input-sleek select-sleek" [class.is-open]="isMonederoOpen"
                            (mousedown)="toggleMonedero($event)">
                            <i class="fas fa-wallet"></i>
                            <div class="sleek-control select-display">
                              <span class="select-value" [class.placeholder]="!recargaForm.get('idMonedero')?.value">
                                {{ monederoLabel || 'Selecciona un monedero...' }}
                              </span>
                            </div>
                            <span class="sleek-line"></span>
                            <div class="select-panel" *ngIf="isMonederoOpen" (mousedown)="$event.stopPropagation()">
                              <button type="button" class="select-option" *ngFor="let m of listaMonederos"
                                (mousedown)="setMonedero(m.id, m.text, $event)">
                                {{ m.text }}
                              </button>
                              <div *ngIf="listaMonederos.length === 0" class="select-option select-option-disabled">
                                No hay monederos disponibles
                              </div>
                            </div>
                          </div>
                        </label>
                        <div class="info-display" *ngIf="monederoSeleccionado">
                          <div class="info-row">
                            <span class="info-label">
                              <i class="fas fa-barcode"></i>
                              Número:
                            </span>
                            <span class="info-value">{{ monederoSeleccionado.numeroMonedero || 'Sin registro' }}</span>
                          </div>
                          <div class="info-row">
                            <span class="info-label">
                              <i class="fas fa-tag"></i>
                              Alias:
                            </span>
                            <span class="info-value">{{ monederoSeleccionado.alias || 'Sin registro' }}</span>
                          </div>
                          <div class="info-row">
                            <span class="info-label">
                              <i class="fas fa-user"></i>
                              Afiliado:
                            </span>
                            <span class="info-value">{{ monederoSeleccionado.nombreCompletoAfiliado || 'Sin registro' }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Monto a Recargar -->
                  <div class="col-12">
                    <div class="info-card info-card-monto">
                      <div class="info-card-header">
                        <div class="info-card-icon icon-monto">
                          <i class="fas fa-coins"></i>
                        </div>
                        <div>
                          <h5 class="info-card-title">Monto a Recargar</h5>
                          <p class="info-card-subtitle">Ingresa el monto que deseas cargar al monedero</p>
                        </div>
                      </div>
                      <div class="info-card-body">
                        <div class="row g-3" style="display: flex; align-items: center; justify-content: center;">
                          <div class="col-12 col-md-6 col-lg-4">
                            <label class="field">
                              <span class="field-label text-white">Monto *</span>
                              <div class="input-sleek input-monto-large">
                                <i class="fas fa-dollar-sign"></i>
                                <input formControlName="monto" class="sleek-control" type="number" min="0" step="0.01" placeholder="0.00" />
                                <span class="sleek-line"></span>
                              </div>
                            </label>
                          </div>
                          <div class="col-12 col-md-6 col-lg-8">
                            <div class="quick-amounts">
                              <button type="button" class="quick-amount-btn" (click)="setMontoRapido(100)">
                                <span class="quick-amount-icon">
                                  <i class="fas fa-hand-holding-usd"></i>
                                </span>
                                <span class="quick-amount-value">$100</span>
                              </button>
                              <button type="button" class="quick-amount-btn" (click)="setMontoRapido(500)">
                                <span class="quick-amount-icon">
                                  <i class="fas fa-hand-holding-usd"></i>
                                </span>
                                <span class="quick-amount-value">$500</span>
                              </button>
                              <button type="button" class="quick-amount-btn" (click)="setMontoRapido(1000)">
                                <span class="quick-amount-icon">
                                  <i class="fas fa-hand-holding-usd"></i>
                                </span>
                                <span class="quick-amount-value">$1,000</span>
                              </button>
                              <button type="button" class="quick-amount-btn" (click)="setMontoRapido(2000)">
                                <span class="quick-amount-icon">
                                  <i class="fas fa-hand-holding-usd"></i>
                                </span>
                                <span class="quick-amount-value">$2,000</span>
                              </button>
                              <button type="button" class="quick-amount-btn" (click)="setMontoRapido(5000)">
                                <span class="quick-amount-icon">
                                  <i class="fas fa-hand-holding-usd"></i>
                                </span>
                                <span class="quick-amount-value">$5,000</span>
                              </button>
                            </div>
                          </div>
                        </div>
                        <div class="monto-display" *ngIf="recargaForm.get('monto')?.value">
                          <div class="monto-display-card">
                            <div class="monto-display-icon">
                              <i class="fas fa-coins"></i>
                            </div>
                            <div class="monto-display-content">
                              <div class="monto-display-label">Monto Total a Recargar</div>
                              <div class="monto-display-value">{{ formatearMoneda(recargaForm.get('monto')?.value) }}</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Resumen de la Transacción -->
                  <div class="col-12" *ngIf="turnoSeleccionado && monederoSeleccionado && recargaForm.get('monto')?.value">
                    <div class="info-card info-card-resumen">
                      <div class="info-card-header">
                        <div class="info-card-icon icon-resumen">
                          <i class="fas fa-receipt"></i>
                        </div>
                        <div>
                          <h5 class="info-card-title">Resumen de Transacción</h5>
                          <p class="info-card-subtitle">Revisa los detalles antes de confirmar</p>
                        </div>
                      </div>
                      <div class="info-card-body">
                        <div class="resumen-grid">
                          <div class="resumen-item">
                            <div class="resumen-item-header">
                              <i class="fas fa-cash-register"></i>
                              <span>Turno</span>
                            </div>
                            <div class="resumen-item-value">{{ turnoSeleccionado.codigoCaja || 'Sin registro' }}</div>
                            <div class="resumen-item-detail">{{ turnoSeleccionado.nombreCaja || 'Sin registro' }}</div>
                          </div>
                          <div class="resumen-item">
                            <div class="resumen-item-header">
                              <i class="fas fa-wallet"></i>
                              <span>Monedero</span>
                            </div>
                            <div class="resumen-item-value">{{ monederoSeleccionado.numeroMonedero || 'Sin registro' }}</div>
                            <div class="resumen-item-detail">{{ monederoSeleccionado.alias || 'Sin registro' }}</div>
                          </div>
                          <div class="resumen-item resumen-item-highlight">
                            <div class="resumen-item-header">
                              <i class="fas fa-coins"></i>
                              <span>Monto</span>
                            </div>
                            <div class="resumen-item-value-large">{{ formatearMoneda(recargaForm.get('monto')?.value) }}</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Botones de Acción -->
                  <div class="col-12">
                    <div class="action-buttons-container">
                      <button type="button" class="btn-action-recarga btn-action-recarga-secondary" (click)="limpiarFormulario()">
                        <i class="fas fa-times"></i>
                        <span>Cancelar</span>
                      </button>
                      <button type="button" class="btn-action-recarga btn-action-recarga-primary" (click)="procesarRecarga()" [disabled]="recargaForm.invalid || procesando">
                        <i class="fas fa-check" *ngIf="!procesando"></i>
                        <i class="fas fa-spinner fa-spin" *ngIf="procesando"></i>
                        <span>{{ procesando ? 'Procesando...' : 'Confirmar Recarga' }}</span>
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
