<div class="container-fluid" [@fadeInRight]>
  <div class="row">
    <div class="col-12">
      <div class="title-banner-card shadow-sm">
        <div class="title-banner-content d-flex align-items-center justify-content-between flex-wrap p-1 pb-0">
          <div class="d-flex align-items-center gap-3">
            <div class="title-icon">
              <i class="fas fa-plus"></i>
            </div>
            <div>
              <h4 class="title-title">{{ title }}</h4>
              <p class="title-subtitle">Captura la información requerida para el registro.</p>
            </div>
          </div>
          <div class="title-actions">
            <div class="title-tagline">
              <span class="line"></span>
              <span class="text">Control y configuración centralizada</span>
            </div>
          </div>
        </div>
        <div class="row mt-3 gy-4">
          <form [formGroup]="salaForm">
            <div class="col-12">
              <!-- Sección: Información General -->
              <div class="form-section">
                <div class="section-header">
                  <div class="section-icon">
                    <i class="fas fa-info-circle"></i>
                  </div>
                  <h5 class="section-title">Información General</h5>
                  <div class="section-line"></div>
                </div>
                <div class="row mt-0">
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Nombre</span>
                      <div class="input-sleek">
                        <i class="fas fa-user"></i>
                        <input formControlName="nombre" class="sleek-control" type="text"
                          placeholder="Nombre completo" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Nombre Comercial</span>
                      <div class="input-sleek">
                        <i class="fas fa-store"></i>
                        <input formControlName="nombreComercial" class="sleek-control" type="text"
                          placeholder="Nombre comercial" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Cliente</span>
                      <div class="input-sleek select-sleek" [class.is-open]="isClienteOpen"
                        (mousedown)="toggleCliente($event)">
                        <i class="fas fa-building"></i>
                        <div class="sleek-control select-display">
                          <span class="select-value" [class.placeholder]="!salaForm.get('idCliente')?.value">
                            {{ clienteLabel || 'Selecciona un cliente...' }}
                          </span>
                        </div>
                        <span class="sleek-line"></span>
                        <div class="select-panel" *ngIf="isClienteOpen" (mousedown)="$event.stopPropagation()">
                          <button type="button" class="select-option" *ngFor="let c of listaClientes"
                            (mousedown)="setCliente(c.id, c.nombre, $event)">
                            {{ c.nombre }}
                          </button>
                        </div>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Descripción</span>
                      <div class="input-sleek input-sleek--textarea">
                        <i class="fas fa-align-left"></i>
                        <textarea formControlName="descripcion" class="sleek-control sleek-control--textarea" rows="4"
                          placeholder="Escribe una breve descripción..."></textarea>
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Sección: Dirección -->
              <div class="form-section">
                <div class="section-header">
                  <div class="section-icon">
                    <i class="fas fa-map-marker-alt"></i>
                  </div>
                  <h5 class="section-title">Dirección del Lugar</h5>
                  <div class="section-line"></div>
                </div>
                <div class="row mt-0">
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Dirección</span>
                      <div class="input-sleek">
                        <i class="fas fa-map-marker-alt"></i>
                        <input formControlName="direccion" class="sleek-control" type="text"
                          placeholder="Dirección completa" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <!-- 
                Comentado por el momento
                <div class="col-12 col-lg-3">
                  <label class="field">
                    <span class="field-label text-white">País</span>
                    <div class="input-sleek">
                      <i class="fas fa-flag"></i>
                      <input formControlName="pais" class="sleek-control" type="text" placeholder="País" />
                      <span class="sleek-line"></span>
                    </div>
                  </label>
                </div>
                  -->
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Estado</span>
                      <div class="input-sleek">
                        <i class="fas fa-map"></i>
                        <input formControlName="estado" class="sleek-control" type="text" placeholder="Estado" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Municipio</span>
                      <div class="input-sleek">
                        <i class="fas fa-city"></i>
                        <input formControlName="municipio" class="sleek-control" type="text" placeholder="Municipio" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Colonia</span>
                      <div class="input-sleek">
                        <i class="fas fa-road"></i>
                        <input formControlName="colonia" class="sleek-control" type="text" placeholder="Colonia" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Calle</span>
                      <div class="input-sleek">
                        <i class="fas fa-road"></i>
                        <input formControlName="calle" class="sleek-control" type="text" placeholder="Calle" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Número Exterior</span>
                      <div class="input-sleek">
                        <i class="fas fa-hashtag"></i>
                        <input formControlName="numeroExterior" class="sleek-control" type="text"
                          placeholder="No. exterior" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Número Interior</span>
                      <div class="input-sleek">
                        <i class="fas fa-hashtag"></i>
                        <input formControlName="numeroInterior" class="sleek-control" type="text"
                          placeholder="No. interior" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Código Postal</span>
                      <div class="input-sleek">
                        <i class="fas fa-mail-bulk"></i>
                        <input maxlength="5" (keypress)="allowOnlyNumbers($event)" formControlName="codigoPostal"
                          class="sleek-control" type="text" placeholder="Código postal" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Referencias</span>
                      <div class="input-sleek">
                        <i class="fas fa-info-circle"></i>
                        <input formControlName="referencias" class="sleek-control" type="text"
                          placeholder="Referencias" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Sección: Datos del Lugar -->
              <div class="form-section">
                <div class="section-header">
                  <div class="section-icon">
                    <i class="fas fa-building"></i>
                  </div>
                  <h5 class="section-title">Datos del Lugar</h5>
                  <div class="section-line"></div>
                </div>
                <div class="row mt-0">
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Metros Cuadrados</span>
                      <div class="input-sleek">
                        <i class="fas fa-ruler-combined"></i>
                        <input formControlName="metrosCuadrados" class="sleek-control" type="text" placeholder="0" (keypress)="allowOnlyNumbers($event)" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Número Niveles</span>
                      <div class="input-sleek">
                        <i class="fas fa-layer-group"></i>
                        <input formControlName="numeroNiveles" class="sleek-control" type="text" placeholder="0" (keypress)="allowOnlyNumbers($event)" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label class="field">
                      <span class="field-label text-white">Capacidad Personas</span>
                      <div class="input-sleek">
                        <i class="fas fa-users"></i>
                        <input formControlName="capacidadPersonas" class="sleek-control" type="text" placeholder="0" (keypress)="allowOnlyNumbers($event)" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <!-- <div class="col-12 col-lg-3">
                  <label class="field">
                    <span class="field-label text-white">Plano Arquitectónico</span>
                    <div class="input-sleek">
                      <i class="fas fa-drafting-compass"></i>
                      <input formControlName="planoArquitectonico" class="sleek-control" type="text"
                        placeholder="Plano arquitectónico" />
                      <span class="sleek-line"></span>
                    </div>
                  </label>
                </div>
                <div class="col-12 col-lg-3">
                  <label class="field">
                    <span class="field-label text-white">Plano Distribución</span>
                    <div class="input-sleek">
                      <i class="fas fa-project-diagram"></i>
                      <input formControlName="planoDistribucion" class="sleek-control" type="text"
                        placeholder="Plano distribución" />
                      <span class="sleek-line"></span>
                    </div>
                  </label>
                </div> -->
                </div>
              </div>

              <!-- Sección: Licencia y Contrato -->
              <div class="form-section">
                <div class="section-header">
                  <div class="section-icon">
                    <i class="fas fa-file-contract"></i>
                  </div>
                  <h5 class="section-title">Licencia y Contrato</h5>
                  <div class="section-line"></div>
                </div>
                <div class="row mt-0">
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="field">
                      <span class="field-label text-white">Fecha Vencimiento Licencia</span>
                      <div class="input-sleek">
                        <i class="fas fa-calendar-alt"></i>
                        <input formControlName="fechaVencimientoLicencia" class="sleek-control" type="date" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="field">
                      <span class="field-label text-white">Moneda Principal</span>
                      <div class="input-sleek select-sleek" [class.is-open]="isIdMonedaOpen"
                        (mousedown)="toggleIdMoneda($event)">
                        <i class="fas fa-coins"></i>
                        <div class="sleek-control select-display">
                          <span class="select-value"
                            [class.placeholder]="salaForm.get('idMonedaPrincipal')?.value == null">
                            {{ idMonedaLabel || 'Seleccione una moneda' }}
                          </span>
                        </div>
                        <span class="sleek-line"></span>
                        <div class="select-panel" *ngIf="isIdMonedaOpen" (mousedown)="$event.stopPropagation()">
                          <button type="button" class="select-option" *ngFor="let it of idMonedaItems"
                            (mousedown)="setIdMoneda(it.id, it.text, $event)">
                            {{ it.text }}
                          </button>
                        </div>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="field">
                      <span class="field-label text-white">Estatus Licencia</span>
                      <div class="input-sleek select-sleek" [class.is-open]="isIdEstatusLicOpen"
                        (mousedown)="toggleIdEstatusLic($event)">
                        <i class="fas fa-toggle-on"></i>
                        <div class="sleek-control select-display">
                          <span class="select-value"
                            [class.placeholder]="salaForm.get('idEstatusLicencia')?.value == null">
                            {{ idEstatusLicLabel || 'Seleccione un estatus' }}
                          </span>
                        </div>
                        <span class="sleek-line"></span>
                        <div class="select-panel" *ngIf="isIdEstatusLicOpen" (mousedown)="$event.stopPropagation()">
                          <button type="button" class="select-option" *ngFor="let it of idEstatusLicItems"
                            (mousedown)="setIdEstatusLic(it.id, it.text, $event)">
                            {{ it.text }}
                          </button>
                        </div>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="field">
                      <span class="field-label text-white">Fecha Inicio Contrato</span>
                      <div class="input-sleek">
                        <i class="fas fa-calendar-check"></i>
                        <input formControlName="fechaInicioContrato" class="sleek-control" type="date" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="field">
                      <span class="field-label text-white">Fecha Fin Contrato</span>
                      <div class="input-sleek">
                        <i class="fas fa-calendar-times"></i>
                        <input formControlName="fechaFinContrato" class="sleek-control" type="date" />
                        <span class="sleek-line"></span>
                      </div>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sección: Documentos -->
            <div class="form-section mt-5">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-folder-open"></i>
                </div>
                <h5 class="section-title">Documentos</h5>
                <div class="section-line"></div>
              </div>
              <div class="row g-3 mt-0">
                <div class="col-12 col-md-6 col-lg-3 mt-2">
                  <div class="pf-uploader" [class.has-file]="logotipoPreviewUrl || logotipoFileName"
                    [class.dragging]="logotipoDragging" (click)="openLogotipoFilePicker()"
                    (dragover)="onLogotipoDragOver($event)" (dragleave)="onLogotipoDragLeave($event)"
                    (drop)="onLogotipoDrop($event)">
                    <div class="pf-top">
                      <div class="pf-title">
                        <i class="fas fa-image"></i>
                        <span>Logotipo</span>
                      </div>
                      <div class="pf-badge">3 MB</div>
                    </div>
                    <div class="pf-mid" *ngIf="logotipoPreviewUrl || logotipoFileName; else logotipoEmpty">
                      <div class="pf-hero" *ngIf="logotipoPreviewUrl">
                        <img [src]="logotipoPreviewUrl" alt="Logotipo" />
                      </div>
                      <div class="file-name" *ngIf="logotipoFileName">{{ logotipoFileName }}</div>
                      <div class="pf-actions" (click)="$event.stopPropagation()">
                        <button type="button" class="pf-btn pf-btn--primary" (click)="openLogotipoFilePicker()">
                          <i class="fas fa-sync-alt"></i>
                          <span>Reemplazar</span>
                        </button>
                        <button type="button" class="pf-btn pf-btn--ghost" (click)="clearLogotipo($event)">
                          <i class="fas fa-trash"></i>
                          <span>Eliminar</span>
                        </button>
                      </div>
                    </div>
                    <ng-template #logotipoEmpty>
                      <div class="pf-empty">
                        <div class="pf-orb">
                          <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="pf-copy">
                          <div class="pf-main">Subir logotipo</div>
                          <div class="pf-sub">Arrastra o haz clic · JPG/PNG/WEBP</div>
                        </div>
                        <div class="pf-cta">
                          <span>Seleccionar</span>
                          <i class="fas fa-arrow-right"></i>
                        </div>
                      </div>
                    </ng-template>
                    <input type="file" #logotipoFileInput accept=".jpg,.jpeg,.png,.webp" hidden
                      (change)="onLogotipoSelected($event)" />
                  </div>
                </div>
                <div class="col-12 col-md-6 col-lg-3 mt-2">
                  <div class="pf-uploader" [class.has-file]="licenciaPreviewUrl || licenciaFileName"
                    [class.dragging]="licenciaDragging" (click)="openLicenciaFilePicker()"
                    (dragover)="onLicenciaDragOver($event)" (dragleave)="onLicenciaDragLeave($event)"
                    (drop)="onLicenciaDrop($event)">
                    <div class="pf-top">
                      <div class="pf-title">
                        <i class="fas fa-file-signature"></i>
                        <span>Licencia de Operación</span>
                      </div>
                      <div class="pf-badge">5 MB</div>
                    </div>
                    <div class="pf-mid" *ngIf="licenciaPreviewUrl || licenciaFileName; else licenciaEmpty">
                      <div class="pf-hero" *ngIf="licenciaPreviewUrl">
                        <img [src]="licenciaPreviewUrl" alt="Licencia" />
                      </div>
                      <div class="file-name" *ngIf="licenciaFileName">{{ licenciaFileName }}</div>
                      <div class="pf-actions" (click)="$event.stopPropagation()">
                        <button type="button" class="pf-btn pf-btn--primary" (click)="openLicenciaFilePicker()">
                          <i class="fas fa-sync-alt"></i>
                          <span>Reemplazar</span>
                        </button>
                        <button type="button" class="pf-btn pf-btn--ghost" (click)="clearLicencia($event)">
                          <i class="fas fa-trash"></i>
                          <span>Eliminar</span>
                        </button>
                      </div>
                    </div>
                    <ng-template #licenciaEmpty>
                      <div class="pf-empty">
                        <div class="pf-orb">
                          <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="pf-copy">
                          <div class="pf-main">Subir licencia</div>
                          <div class="pf-sub">Arrastra o haz clic · PDF/JPG/PNG/WEBP</div>
                        </div>
                        <div class="pf-cta">
                          <span>Seleccionar</span>
                          <i class="fas fa-arrow-right"></i>
                        </div>
                      </div>
                    </ng-template>
                    <input type="file" #licenciaFileInput accept=".pdf,.jpg,.jpeg,.png,.webp" hidden
                      (change)="onLicenciaSelected($event)" />
                  </div>
                </div>
                <div class="col-12 col-md-6 col-lg-3 mt-2">
                  <div class="pf-uploader" [class.has-file]="planoPreviewUrl || planoFileName"
                    [class.dragging]="planoDragging" (click)="openPlanoFilePicker()"
                    (dragover)="onPlanoDragOver($event)" (dragleave)="onPlanoDragLeave($event)"
                    (drop)="onPlanoDrop($event)">

                    <div class="pf-top">
                      <div class="pf-title">
                        <i class="fas fa-drafting-compass"></i>
                        <span>Plano arquitectónico</span>
                      </div>
                      <div class="pf-badge">3 MB</div>
                    </div>

                    <div class="pf-mid" *ngIf="planoPreviewUrl || planoFileName; else planoEmpty">
                      <div class="pf-hero" *ngIf="planoPreviewUrl">
                        <img [src]="planoPreviewUrl" alt="Plano arquitectónico" />
                      </div>

                      <div class="file-name" *ngIf="planoFileName">{{ planoFileName }}</div>

                      <div class="pf-actions" (click)="$event.stopPropagation()">
                        <button type="button" class="pf-btn pf-btn--primary" (click)="openPlanoFilePicker()">
                          <i class="fas fa-sync-alt"></i>
                          <span>Reemplazar</span>
                        </button>

                        <button type="button" class="pf-btn pf-btn--ghost" (click)="clearPlanoFile($event)">
                          <i class="fas fa-trash"></i>
                          <span>Eliminar</span>
                        </button>
                      </div>
                    </div>

                    <ng-template #planoEmpty>
                      <div class="pf-empty">
                        <div class="pf-orb">
                          <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="pf-copy">
                          <div class="pf-main">Subir plano</div>
                          <div class="pf-sub">Arrastra o haz clic · JPG/PNG/WEBP/PDF</div>
                        </div>
                        <div class="pf-cta">
                          <span>Seleccionar</span>
                          <i class="fas fa-arrow-right"></i>
                        </div>
                      </div>
                    </ng-template>

                    <input type="file" #planoFileInput accept=".jpg,.jpeg,.png,.webp,.pdf" hidden
                      (change)="onPlanoFileSelected($event)" />
                  </div>
                </div>
                <div class="col-12 col-md-6 col-lg-3 mt-2">
                  <div class="pf-uploader" [class.has-file]="planoDistribucionPreviewUrl || planoDistribucionFileName"
                    [class.dragging]="planoDistribucionDragging" (click)="openPlanoDistribucionFilePicker()"
                    (dragover)="onPlanoDistribucionDragOver($event)" (dragleave)="onPlanoDistribucionDragLeave($event)"
                    (drop)="onPlanoDistribucionDrop($event)">

                    <div class="pf-top">
                      <div class="pf-title">
                        <i class="fas fa-project-diagram"></i>
                        <span>Plano distribución</span>
                      </div>
                      <div class="pf-badge">3 MB</div>
                    </div>

                    <div class="pf-mid"
                      *ngIf="planoDistribucionPreviewUrl || planoDistribucionFileName; else planoDistribucionEmpty">
                      <div class="pf-hero" *ngIf="planoDistribucionPreviewUrl">
                        <img [src]="planoDistribucionPreviewUrl" alt="Plano distribución" />
                      </div>

                      <div class="file-name" *ngIf="planoDistribucionFileName">{{ planoDistribucionFileName }}</div>

                      <div class="pf-actions" (click)="$event.stopPropagation()">
                        <button type="button" class="pf-btn pf-btn--primary"
                          (click)="openPlanoDistribucionFilePicker()">
                          <i class="fas fa-sync-alt"></i>
                          <span>Reemplazar</span>
                        </button>

                        <button type="button" class="pf-btn pf-btn--ghost" (click)="clearPlanoDistribucionFile($event)">
                          <i class="fas fa-trash"></i>
                          <span>Eliminar</span>
                        </button>
                      </div>
                    </div>

                    <ng-template #planoDistribucionEmpty>
                      <div class="pf-empty">
                        <div class="pf-orb">
                          <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="pf-copy">
                          <div class="pf-main">Subir plano distribución</div>
                          <div class="pf-sub">Arrastra o haz clic · JPG/PNG/WEBP/PDF</div>
                        </div>
                        <div class="pf-cta">
                          <span>Seleccionar</span>
                          <i class="fas fa-arrow-right"></i>
                        </div>
                      </div>
                    </ng-template>

                    <input type="file" #planoDistribucionFileInput accept=".jpg,.jpeg,.png,.webp,.pdf" hidden
                      (change)="onPlanoDistribucionFileSelected($event)" />
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="row mt-4">
          <div class="col-12 d-flex justify-content-start gap-3 flex-wrap">
            <button (click)="submit()" type="button" class="btn-alt btn-alt--success" [disabled]="loading">
              <i class="fas fa-check"></i>
              <span>{{ submitButton }}</span>
            </button>
            <button (click)="regresar()" type="button" class="btn-alt btn-alt--cancel" [disabled]="loading">
              <i class="fas fa-times"></i>
              <span>Cancelar</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>